<app-header></app-header>
<div class="demandas-home-grid-layout">
  <app-breadcrumb [breadcrumb]="breadcrumb"></app-breadcrumb>
  <app-title 
  [title]="nombreProyecto" 
  [subtitle]="subtitle" 
  [boton]="botonActual"
  [ordenActiva]="ordenActiva"
  [comite]="enviarAComite"
  [priorizacionFinal]="priorizacionFinalCompletada"
  (onOrdenar)="priorizacionPrevia()"
  (onEnviarComite)="handleEnviarComite()"
  (onPriorizacionFinal)="handlePriorizacionFinal()">
</app-title>
  <p-table #dt [value]="proyectosPriorizacion" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 20]"
    [globalFilterFields]="['usuario', 'nombreEjecutivo', 'rut', 'instrumento', 'agencia', 'fechaCreacion', 'estado']"
    styleClass="table-striped my-table">
    <ng-template pTemplate="caption">
      <div class="boton-busqueda">
        <label for="busqueda-input">Buscar: </label>
        <div class="input-container">
          <i class="pi pi-search"></i>
          <input style="width: 320px;" pInputText type="text" (input)="buscarTabla($event)" placeholder="Buscar..."
            id="busqueda-input" />
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="usuario" style="width: 5%;">
          Prioriz. <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="nombreEjecutivo" style="width: 15%;">
          Usuario <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="rut" style="width: 10%;">
          RUT <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="instrumento" style="width: 20%;">
          Cod. Proy. <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="agencia" style="width: 10%;">
          Postulación <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="fechaCreacion" style="width: 10%;">
          Estado <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="estado" style="width: 5%;">
          Puntaje <i class="pi pi-sort"></i>
        </th>
        <th pSortableColumn="acciones" style="width: 5%;">
          Acción
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-index="rowIndex">
      <tr>
        <td style="width: 15%; padding-left: 5px;">
          {{ ordenActiva ? rowData.priorizacion : '-' }}
        </td>
        <td style="width: 15%; padding-left: 5px;">{{ rowData.nombre }}</td>
        <td style="width: 10%; padding-left: 5px;">{{ rowData.rut }}</td>
        <td style="width: 20%; padding-left: 5px;">{{ rowData.internalid }}</td>
        <td style="width: 10%; padding-left: 5px;">{{ rowData.fechaPostulacion | date:'dd-MM-yyyy' }}</td>
        <td style="width: 5%; padding-left: 5px;">
          <span *ngIf="rowData.estado === 'RECOMENDACION_APROBADA' || rowData.estado === 'Aprobado'" style="color: #4CAF50;">
            {{ rowData.estado  }}
          </span>
          <span *ngIf="rowData.estado === 'CON_OBSERVACIONES' || rowData.estado === 'Rechazado'" style="color: #FB3B3B;">
            {{ rowData.estado }}
          </span>
        </td>
        <td style="width: 10%; padding-left: 5px;">{{ rowData.puntaje }}</td>
        <td style="width: 10%; padding-left: 5px;">
          <a class="table-link" (click)="toggleLinks(rowData.internalid, $event)">
              <i class="pi pi-cog"></i> Acciones
            </a>
            <div *ngIf="showLinksMap.get(rowData.internalid)" class="additional-links">
              <div *ngIf="rowData.estado === 'ADMISIBLE'">
                <a (click)="verDemanda(rowData.internalid)"><i class="pi pi-search"></i> Ver Demanda</a>
              </div>
              <div *ngIf="rowData.estado !== 'ADMISIBLE'">
                <a (click)="verDemanda(rowData.internalid)"><i class="pi pi-search"></i> Ver Demanda</a>
                <a (click)="editarDemanda(rowData.internalid)"><i class="pi pi-eye"></i> Editar</a>
              </div>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<app-priorizacion-orden-dialog
  [(displayDialog)]="mostrarDialogo"
  (onConfirmar)="onDialogoCerrado($event)">
</app-priorizacion-orden-dialog>

<app-enviar-comite-dialog
  [(displayDialog)]="mostrarDialogoComite"
  (onConfirmar)="onComiteConfirmado($event)">
</app-enviar-comite-dialog>

<app-priorizacion-final-dialog
  [(displayDialog)]="mostrarDialogoFinal"
  (onConfirmar)="onPriorizacionFinalConfirmada($event)">
</app-priorizacion-final-dialog>