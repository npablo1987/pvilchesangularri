<!-- ──────────────── IDENTIFICACIÓN DEL AGRICULTOR ────────────────-->
<div class="row" style="padding-left: 20px" *ngIf="!esRevision">
  <span class="label-1">Identificación del agricultor</span>
</div>

<div class="row div-form">
  <!-- ───────────────────────── Persona natural ──────────────────-->
  <ng-container *ngIf="!mostrarInputsTipoJuridico() && !esRevision">
    <div class="col" style="display:flex;flex-direction:row;align-items:flex-end;gap:10px;">
      <!-- ✅ RUT principal -->
      <app-input-text
        style="width:30%;"
        [placeholder]="'12.345.678-9'"
        [(value)]="identificador"
        (valueChange)="onIdentificadorChange($event)"
      [ngClass]="rutIdentificadorValido ? 'input-success':'input-error'"
      [disable]="false"
      [label]="'RUT'"
      [inputId]="'rutInput'"
      [useFormControl]="false"
      tipo="rut">
      </app-input-text>

      <div style="padding:25px 0;">
        <app-buttons
          [label]="'Buscar'"
          [icon]="'pi pi-search'"
          [action]="identificarAgricultor.bind(this)"
          [disable]="!rutIdentificadorValido">           <!-- NUEVO -->
        </app-buttons>
      </div>
    </div>
  </ng-container>

  <!-- ───────────────────── Persona jurídica / agrupación ─────────-->
  <ng-container *ngIf="mostrarInputsTipoJuridico() && !esRevision">
    <div class="row div-form">
      <!-- ✅ RUT representante legal -->
      <app-input-text
        [placeholder]="''"
        [(value)]="rutRepresentanteLegal"
        (valueChange)="onRutRepresentanteChange($event)"
      [ngClass]="rutRepresentanteLegalValido ? 'input-success':'input-error'"
      [disable]="false"
      [label]="'Rut Representante Legal'"
      [inputId]="'rutRepresentanteLegal'"
      [useFormControl]="false"
      tipo="rut">
      </app-input-text>

      <div style="padding:25px 0;">
        <app-buttons
          [label]="'Buscar'"
          [icon]="'pi pi-search'"
          [action]="filtrarJuridicas.bind(this)"
          [disable]="!rutRepresentanteLegalValido">
        </app-buttons>
      </div>
    </div>

    <!-- Nombre Agrupación (sin validación RUT) -->
    <div class="row div-form">
      <app-input-text
        [placeholder]="''"
        [(value)]="nombreAgrupacion"
        [disable]="false"
        [label]="'Nombre Agrupación'"
        [inputId]="'nombreAgrupacion'"
        [useFormControl]="false">
      </app-input-text>

      <div style="padding:25px 0;">
        <app-buttons
          [label]="'Buscar'"
          [icon]="'pi pi-search'"
          [action]="filtrarAgrupacion.bind(this)">
        </app-buttons>
      </div>
    </div>
  </ng-container>
</div>

<!-- ────────────────── Sección de datos mostrados (sin cambios) ────────────────-->
<!-- El resto del template permanece tal cual (inputs solo lectura, etc.) -->

<!-- Persona natural -->
<div class="div-disabled-inputs"
     *ngIf="informacionAgricultorOk && tipoAgricultor.idTipoUsuario === 1 && mostrarCamposAgricultor"
     style="margin-bottom:5px;">
  <div style="width:70%;margin-right:10px;">
    <app-input-text [placeholder]="''" [(value)]="nombreAgricultor" [disable]="true"
                    [label]="'Nombre completo'" [inputId]="'nombreCompleto'" [useFormControl]="false">
    </app-input-text>
  </div>
  <div style="width:30%;">
    <app-input-text [placeholder]="''" [(value)]="rutAgricultor" [disable]="true" [label]="'RUT'"
                    [inputId]="'rutInput'" [useFormControl]="false" tipo="rut">
    </app-input-text>
  </div>
</div>

<div class="div-disabled-inputs" *ngIf="informacionAgricultorOk && tipoAgricultor.idTipoUsuario === 1 && mostrarCamposAgricultor">
  <div style="width: 35%;">
    <app-input-text [placeholder]="''" [(value)]="sexoAgricultor" [disable]="true"
      [label]="'sexo'" [inputId]="'sexo'" [useFormControl]="false">
    </app-input-text>
  </div>
  <div style="width: 35%; margin: 0px 10px;">
    <app-input-text [placeholder]="''" [(value)]="edadAgricultor" [disable]="true" [label]="'Edad'"
      [inputId]="'edad'" [useFormControl]="false">
    </app-input-text>
  </div>
  <div style="width: 30%;">
    <app-input-text [placeholder]="''" [(value)]="acreditacionAgricultor" [disable]="true" [label]="'Estado Acreditación'"
      [inputId]="'acreditacion'" [useFormControl]="false">
    </app-input-text>
  </div>
</div>

<!-- Persona juridica -->
<div class="div-disabled-inputs" *ngIf="informacionAgricultorOk && tipoAgricultor.idTipoUsuario === 2 && mostrarCamposAgricultor" style="margin-bottom: 5px;">
  <div style="width: 70%; margin-right: 10px;">
    <app-input-text [placeholder]="''" [(value)]="razonSocialAgricultor" [disable]="true"
      [label]="'Razón Social'" [inputId]="'razonSocial'" [useFormControl]="false">
    </app-input-text>
  </div>
  <div style="width: 30%;">
    <app-input-text [placeholder]="''" [(value)]="rutAgricultor" [disable]="true" [label]="'RUT'"
      [inputId]="'rutInput'" [useFormControl]="false">
    </app-input-text>
  </div>
</div>
<div class="div-disabled-inputs" *ngIf="informacionAgricultorOk && tipoAgricultor.idTipoUsuario === 2 && mostrarCamposAgricultor">
  <div style="width: 35%;">
    <app-input-text [placeholder]="''" [(value)]="acreditacionAgricultor" [disable]="true" [label]="'Estado Acreditación'"
      [inputId]="'acreditacion'" [useFormControl]="false">
    </app-input-text>
  </div>
  <div style="width: 64%; margin-left: 10px">
    <app-input-text [placeholder]="''" [(value)]="nombreRepresentanteAgricultor" [disable]="true"
      [label]="'Nombre Representante'" [inputId]="'nombreRepresentante'" [useFormControl]="false">
    </app-input-text>
  </div>
</div>

<!-- Persona juridica -->
<div class="div-disabled-inputs" *ngIf="informacionAgricultorOk && tipoAgricultor.idTipoUsuario === 3 && mostrarCamposAgricultor" style="margin-bottom: 5px;">
  <div style="width: 70%; margin-right: 10px;">
    <app-input-text [placeholder]="''" [(value)]="nombreAgrupacion" [disable]="true"
      [label]="'Nombre Agrupación'" [inputId]="'nombreAgrupacion'" [useFormControl]="false">
    </app-input-text>
  </div>
  <div style="width: 30%;">
    <app-input-text [placeholder]="''" [(value)]="rutAgricultor" [disable]="true" [label]="'RUT'"
      [inputId]="'rutInput'" [useFormControl]="false">
    </app-input-text>
  </div>
</div>
<div class="div-disabled-inputs" *ngIf="informacionAgricultorOk && tipoAgricultor.idTipoUsuario === 3 && mostrarCamposAgricultor">
  <div style="width: 69%;">
    <app-input-text [placeholder]="''" [(value)]="nombreRepresentanteAgricultor" [disable]="true"
      [label]="'Nombre Representante'" [inputId]="'nombreRepresentante'" [useFormControl]="false">
    </app-input-text>
  </div>
</div>

<p-dialog header="Filtrar persona juridica" [(visible)]="displayDialog" modal="modal" [closable]="true"
  [style]="{ width: '65rem' }">
  <ng-template pTemplate="header">
    <span class="dialog-title">Personas Jurídicas y Agrupaciones</span>
  </ng-template>
  <p-divider></p-divider>
  <div class="dialog-content">
    <div class="div-form">
      <p-table [value]="tableData" styleClass="table-striped my-table" [ngStyle]="{'width': '100%'}">
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="nombre" style="width: 5%; padding-left: 8px;">
              Nombre <i class="pi pi-sort"></i>
            </th>
            <th pSortableColumn="rut" style="width: 10%;">
              Rut <i class="pi pi-sort"></i>
            </th>
            <th pSortableColumn="representante" style="width: 50%;">
              Representante <i class="pi pi-sort"></i>
            </th>
            <th style="width: 10%; text-align: center;">Seleccionar</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData let-index="rowIndex">
          <tr>
            <td style="width: 5%; padding-left: 8px;">{{ rowData.nombre }}</td>
            <td style="width: 10%; padding-left: 5px;">{{ rowData.rut }}</td>
            <td style="width: 50%; padding-left: 5px;">{{ rowData.representante || 'Representante no encontrado' }}</td>
            <td style="width: 10%; text-align: center;">
              <p-checkbox
                [binary]="true"
                variant="filled"
                (onChange)="onCheckboxChange(rowData.rut, $event.checked)"
              ></p-checkbox>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</p-dialog>
