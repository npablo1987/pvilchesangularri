<div class="criterios">
  <span class="title">Criterios de priorización y puntos</span>
  <div class="card" *ngFor="let criterio of criterios" style="width: 1128px; margin-bottom: 10px;">
    <p-panel [collapsed]="true" [toggleable]="true" #panel>
      <ng-template pTemplate="header">
        <div class="div-card">
          <div class="header-title" style="width: 15%;">
            <span class="card-criterio-titles">
              Activar
            </span>
            <p-checkbox
              [(ngModel)]="criterio.activar"
              [binary]="true"
              inputId="binary-{{criterio.nombre}}"
              [disabled]="selectedInstrumento && selectedInstrumento.name !== 'BLA'"
              [ngModel]="selectedInstrumento && selectedInstrumento.name !== 'BLA' ? true : criterio.activar"
            />
          </div>          
          <div class="header-title" style="width: 20%;">
            <span class="card-criterio-titles">Carácter</span>
            <span class="texto-header">
              {{ criterio.tipo }}
            </span>
          </div>
          <div class="header-title" style="width: 90%;">
            <span class="card-criterio-titles">Criterio de priorización</span>
            <span class="texto-header">
              {{ criterio.nombre }}
            </span>
          </div>
          <div class="header-title" style="width: 30%;">
            <span class="card-criterio-titles">Ponderación</span>
            <div class="header-title" [ngStyle]="selectedInstrumento && selectedInstrumento.name === 'BLA' ? { 'border': '1px solid black', 'padding': '10px', 'width': '80%' } : {}">
              <span class="texto-header">
                {{ criterio.ponderacion }} 
                <span [ngStyle]="selectedInstrumento && selectedInstrumento.name === 'BLA' ? { 'float': 'right' } : {}">
                  %
                </span>
              </span>
            </div>
          </div>
          <div class="header-title" style="width: 30%;">
            <span class="card-criterio-titles">Carácter</span>
            <span class="texto-header">
              {{ criterio.caracter}}
            </span>
          </div>
          <div class="custom-header">
            <button (click)="panel.toggle($event)" class="custom-toggle-button">
              <div *ngIf="panel.collapsed; else noCollapsed">
                <i class="pi pi-angle-down"></i>
              </div>
              <ng-template #noCollapsed>
                <i class="pi pi-angle-up"></i>
              </ng-template>
            </button>
          </div>
        </div>
      </ng-template>
      <div class="card-panel-body">
        <p-table [value]="criterio.variables" [tableStyle]="{ 'min-width': '50rem' }" class="tabla-variables">
          <ng-template pTemplate="header">
            <tr class="texto-theader">
              <th>Variable</th>
              <th>Puntaje</th>
              <th>Acciones</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-variables>
            <tr class="texto-tbody">
              <td style="width: 50%;">{{ variables.nombre }}</td>
              <td style="width: 20%;">{{ variables.puntaje }} Ptos.</td>
              <td style="width: 40%;" *ngIf="!criteriosAprobar"> <a class="table-link-edit"
                  (click)="showEditDialog(criterio, variables)"><i class="pi pi-pencil"></i> Editar</a>
                <a class="table-link-delete" style="margin-left: 20px;" (click)="deleteVariable(criterio, variables)"><i
                    class="pi pi-trash"></i> Eliminar</a>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <div class="div-boton" *ngIf="!criteriosAprobar; else noAprobar">
          <a (click)="showAddDialog(criterio)" class="boton-variable-agregar"><i class="pi pi-plus"></i> Agregar
            Variable</a>
        </div>
        <ng-template #noAprobar>
          <div class="espacio"></div>
        </ng-template>
      </div>
    </p-panel>
  </div>
</div>

<p-dialog header="Agregar variable" [modal]="true" [(visible)]="visible" [style]="{ width: '33rem', height: '372px' }">
  <ng-template pTemplate="header">
    <span class="dialog-title">Agregar variable</span>
  </ng-template>
  <p-divider />
  <div class="dialog-content">
    <div style="padding: 0 15px 0 15px">
      <span class="subtitle-dialog">Define la variable que se considerará para la evaluación.</span>
      <div class="input-group mb-3" style="margin-top: 20px;">
        <label for="nombre" class="font-semibold">Nombre de la variable:</label>
        <input pInputText id="nombre" [(ngModel)]="newVariable.nombre" class="full-width" autocomplete="off" />
      </div>
      <div class="dialog-input">
        <label for="puntaje" class="font-semibold">Puntaje (min: 1 / máx: 100):</label>
        <p-inputNumber id="puntaje" [(ngModel)]="newVariable.puntaje" class="full-width" [min]="1" [max]="100" />
      </div>
      <div *ngIf="errorMessage" style="color: red; margin-top: 10px;">
        {{ errorMessage }}
      </div>
      <div class="button-publish" style="margin-top: 20px;">
        <button class="button-publicar" (click)="saveVariable()" style="align-items: end;">
          <i class="pi pi-save"></i> Guardar variable
        </button>
      </div>
    </div>
  </div>
</p-dialog>